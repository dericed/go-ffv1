#!/usr/bin/env perl

# Simple code gen tool to make a 16 and 32 bit person of deriveBorders.
# In theory, I could have just used an interface, but that's just
# ugly in a different way.

use strict;
use warnings;

my $bitdepth = shift;

open(my $if, "<", "pred.go") || die("cannot open pred.go for reading");
open(my $of, ">", "pred$bitdepth.go") || die("cannot open pred$bitdepth.go for writing");

print $of "package ffv1\n\n";
print $of "// This file is automatically generated from pred.go using go generate\n";
print $of "// Please DO NOT manually modify this file\n\n";

my $started = 0;
while (<$if>) {
    if (/deriveBorders/) {
        s/deriveBorders/deriveBorders$bitdepth/;
        s/uint8/uint$bitdepth/;
        print $of $_;
        $started = 1;
        next;
    }
    if ($started == 0) {
        next;
    }
    if (/^}/) {
        print $of $_;
        last;
    }
    print $of $_;
}

close($if);
close($of);
